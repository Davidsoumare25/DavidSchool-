<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DavidSchool - Exercices</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
:root{
  --main:#1e90ff;
  --bg:#f4f7fb;
  --card:#ffffff;
  --text:#333;
  --accent:#ff9900;
}
body{
  margin:0;
  font-family:Arial,sans-serif;
  background:var(--bg);
}
header{
  background:var(--main);
  color:white;
  padding:15px;
  text-align:center;
  font-size:22px;
  font-weight:bold;
  position:relative;
}
#adminIcon{
  position:absolute;
  top:10px;
  left:10px;
  background:white;
  color:var(--main);
  padding:10px 12px;
  border-radius:50%;
  cursor:pointer;
  font-weight:bold;
  box-shadow:0 2px 6px rgba(0,0,0,.2);
  z-index:2000;
}
.container{padding:20px;}
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(120px,1fr));
  gap:15px;
}
.card{
  background:var(--card);
  padding:20px;
  border-radius:12px;
  text-align:center;
  cursor:pointer;
  box-shadow:0 2px 6px rgba(0,0,0,.1);
  font-weight:bold;
  transition:transform 0.2s, box-shadow 0.2s;
}
.card:hover{
  transform:scale(1.05);
  box-shadow:0 4px 10px rgba(0,0,0,.15);
}
#subjects,#exercises{display:none;}
.item{
  border-bottom:1px solid #eee;
  padding:8px;
}
.item img{
  max-width:100%;
  border-radius:8px;
  margin-top:5px;
}
/* Colors classes */
.c6e{background:#16a34a;color:white;}
.c5e{background:#2563eb;color:white;}
.c4e{background:#9333ea;color:white;}
.c3e{background:#f59e0b;color:white;}
/* Colors mati√®res */
.mMath{background:#fbbf24;color:white;}
.mFran√ßais{background:#f87171;color:white;}
.mAnglais{background:#60a5fa;color:white;}
.mHistoire{background:#34d399;color:white;}
.mG√©ographie{background:#a78bfa;color:white;}
.mSVT{background:#10b981;color:white;}
.mPhysique-Chimie{background:#f472b6;color:white;}
/* ADMIN */
#adminModal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  z-index:3000;
}
#adminBox{
  background:white;
  width:90%;
  max-width:400px;
  margin:60px auto;
  padding:20px;
  border-radius:12px;
  box-shadow:0 4px 12px rgba(0,0,0,.25);
}
input,select,button{
  width:100%;
  margin:6px 0;
  padding:10px;
  border-radius:8px;
  border:1px solid #ccc;
}
button{
  background:var(--main);
  color:white;
  border:none;
  cursor:pointer;
  font-weight:bold;
}
button:hover{background:var(--accent);}
</style>
</head>
<body>
<header>
  üìò DavidSchool
  <div id="adminIcon">‚öô</div>
</header>
<div class="container">
<!-- CLASSES -->
<div id="classes" class="grid">
  <div class="card c6e" onclick="selectClass('6e')">6e</div>
  <div class="card c5e" onclick="selectClass('5e')">5e</div>
  <div class="card c4e" onclick="selectClass('4e')">4e</div>
  <div class="card c3e" onclick="selectClass('3e')">3e</div>
</div>

<!-- MATI√àRES -->
<div id="subjects" class="grid"></div>

<!-- EXERCICES -->
<div id="exercises" class="grid"></div>
</div>

<!-- ADMIN -->
<div id="adminModal">
  <div id="adminBox">
    <h3>Admin</h3>
    <input type="password" id="adminPass" placeholder="Mot de passe">
    <button onclick="login()">Entrer</button>

    <div id="adminPanel" style="display:none">
      <select id="aClass">
        <option>6e</option>
        <option>5e</option>
        <option>4e</option>
        <option>3e</option>
      </select>
      <p>Mati√®res (optionnelles)</p>
      <label><input type="checkbox" value="Math"> Math</label><br>
      <label><input type="checkbox" value="Fran√ßais"> Fran√ßais</label><br>
      <label><input type="checkbox" value="Anglais"> Anglais</label><br>
      <label><input type="checkbox" value="Histoire"> Histoire</label><br>
      <label><input type="checkbox" value="G√©ographie"> G√©ographie</label><br>
      <label><input type="checkbox" value="SVT"> SVT</label><br>
      <label><input type="checkbox" value="Physique-Chimie"> Physique-Chimie</label><br>
      <input id="aTitle" placeholder="Titre">
      <input type="file" id="aFile">
      <button onclick="addContent()">Ajouter</button>
    </div>
    <button onclick="closeAdmin()">Fermer</button>
  </div>
</div>

<script>
const SUPABASE_URL = "https://xwzjlddgqwlrxgetahvp.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh3empsZGRncX";
const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

let currentClass="", currentSubject="";
const subjectsByClass={
  "6e":["Math","Fran√ßais","Anglais","Histoire","G√©ographie","SVT"],
  "5e":["Math","Fran√ßais","Anglais","Histoire","G√©ographie","SVT"],
  "4e":["Math","Fran√ßais","Anglais","Histoire","G√©ographie","SVT","Physique-Chimie"],
  "3e":["Math","Fran√ßais","Anglais","Histoire","G√©ographie","SVT","Physique-Chimie"]
};

function selectClass(c){
  currentClass=c;
  document.getElementById("classes").style.display="none";
  const s=document.getElementById("subjects");
  s.innerHTML="";
  subjectsByClass[c].forEach(m=>{
    const colorClass="m"+m.replace(/ /g,'-');
    s.innerHTML+=`<div class="card ${colorClass}" onclick="selectSubject('${m}')">${m}</div>`;
  });
  s.style.display="grid";
}

async function selectSubject(m){
  currentSubject=m;
  document.getElementById("subjects").style.display="none";
  document.getElementById("exercises").style.display="grid";
  await loadContent();
}

async function loadContent(){
  exercises.innerHTML="";
  const {data} = await supabase
    .from("contents")
    .select("*")
    .eq("classe",currentClass)
    .eq("matiere",currentSubject);

  data.forEach(d=>{
    const div=document.createElement("div");
    div.className="item";
    div.innerHTML=`<b>${d.title}</b><br>${
      d.file_url?.endsWith(".pdf")
      ? `<a href="${d.file_url}" target="_blank">T√©l√©charger</a>`
      : `<img src="${d.file_url}">`
    }`;
    exercises.appendChild(div);
  });
}

/* ADMIN */
adminIcon.onclick=()=>adminModal.style.display="block";
function closeAdmin(){adminModal.style.display="none";}
function login(){
  if(adminPass.value==="1234"){
    adminPanel.style.display="block";
  } else alert("Mot de passe incorrect");
}

async function addContent(){
  const file=aFile.files[0];
  let fileUrl="";
  if(file){
    const path=Date.now()+"_"+file.name;
    await supabase.storage.from("davidschool").upload(path,file);
    const {data:{publicUrl}} = supabase.storage.from("davidschool").getPublicUrl(path);
    fileUrl=publicUrl;
  }
  document.querySelectorAll('input[type=checkbox]:checked').forEach(cb=>{
    supabase.from("contents").insert({
      classe:aClass.value,
      matiere:cb.value,
      title:aTitle.value,
      file_url:fileUrl
    });
  });
  alert("Exercice ajout√© !");
  if(currentClass && currentSubject) loadContent();
}
</script>
</body>
</html>
