<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DavidSchool â€“ Exercices</title>

<!-- Supabase -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
:root{
  --blue:#2563eb;
  --bg:#f4f6fb;
  --card:#ffffff;
}
*{box-sizing:border-box;font-family:Arial, sans-serif}
body{margin:0;background:var(--bg)}

/* ===== HEADER ===== */
header{
  background:var(--blue);
  color:white;
  padding:16px;
  text-align:center;
  font-size:22px;
  position:relative;
}
#adminIcon{
  position:absolute;
  left:12px;
  top:12px;
  background:white;
  color:var(--blue);
  width:40px;
  height:40px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  font-weight:bold;
}

/* ===== SECTIONS ===== */
.section{display:none;padding:18px}
.section.active{display:block}

/* ===== GRID ===== */
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(140px,1fr));
  gap:14px;
}
.card{
  padding:22px;
  border-radius:14px;
  color:white;
  text-align:center;
  font-weight:bold;
  cursor:pointer;
  box-shadow:0 4px 10px rgba(0,0,0,.12);
  transition:.2s;
}
.card:hover{transform:scale(1.05)}

/* Classes */
.c6e{background:#16a34a}
.c5e{background:#0ea5e9}
.c4e{background:#6366f1}
.c3e{background:#9333ea}

/* MatiÃ¨res */
.math{background:#f59e0b}
.fr{background:#ef4444}
.ang{background:#14b8a6}
.hist{background:#64748b}
.geo{background:#22c55e}
.svt{background:#10b981}
.pc{background:#dc2626}

/* ===== BUTTONS ===== */
button{
  padding:12px;
  border:none;
  border-radius:10px;
  font-weight:bold;
  cursor:pointer;
}
.back{background:#334155;color:white;margin-bottom:10px}

/* ===== EXERCISES ===== */
.item{
  background:white;
  padding:12px;
  border-radius:10px;
  margin-bottom:10px;
  box-shadow:0 2px 6px rgba(0,0,0,.08);
}
.item img{max-width:100%;border-radius:8px}

/* ===== ADMIN ===== */
#adminModal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:3000;
}
.adminBox{
  background:white;
  padding:20px;
  width:90%;
  max-width:420px;
  border-radius:14px;
}
input,select{
  width:100%;
  padding:10px;
  margin:6px 0;
}
</style>
</head>

<body>

<header>
  <div id="adminIcon">âš™</div>
  ðŸ“˜ DavidSchool â€“ Exercices
</header>

<!-- ===== CLASSES ===== -->
<div id="classes" class="section active">
  <h3>Choisis ta classe</h3>
  <div class="grid">
    <div class="card c6e" data-classe="6e">6e</div>
    <div class="card c5e" data-classe="5e">5e</div>
    <div class="card c4e" data-classe="4e">4e</div>
    <div class="card c3e" data-classe="3e">3e</div>
  </div>
</div>

<!-- ===== MATIÃˆRES ===== -->
<div id="subjects" class="section">
  <button class="back" id="backToClasses">â¬… Retour</button>
  <h3 id="classeTitre"></h3>
  <div class="grid" id="subjectsList"></div>
</div>

<!-- ===== EXERCICES ===== -->
<div id="exercisesSection" class="section">
  <button class="back" id="backToSubjects">â¬… Retour</button>
  <h3 id="exerciseTitle"></h3>
  <div id="exercisesList"></div>
</div>

<!-- ===== ADMIN ===== -->
<div id="adminModal">
  <div class="adminBox">
    <h3>Admin</h3>
    <input type="password" id="adminPass" placeholder="Mot de passe">
    <button id="loginBtn">Entrer</button>

    <div id="adminPanel" style="display:none">
      <select id="aClasse">
        <option>6e</option><option>5e</option><option>4e</option><option>3e</option>
      </select>

      <p>MatiÃ¨res</p>
      <label><input type="checkbox" value="Maths"> Maths</label><br>
      <label><input type="checkbox" value="FranÃ§ais"> FranÃ§ais</label><br>
      <label><input type="checkbox" value="Anglais"> Anglais</label><br>
      <label><input type="checkbox" value="Histoire"> Histoire</label><br>
      <label><input type="checkbox" value="GÃ©ographie"> GÃ©ographie</label><br>
      <label><input type="checkbox" value="SVT"> SVT</label><br>
      <label><input type="checkbox" value="Physique-Chimie"> Physique-Chimie</label><br>

      <input id="aTitle" placeholder="Titre exercice">
      <input type="file" id="aFile">
      <button id="addBtn">Ajouter</button>
    </div>

    <button onclick="closeAdmin()">Fermer</button>
  </div>
</div>

<script>
/* ===== SUPABASE ===== */
const supabaseClient = supabase.createClient(
  "https://xwzjlddgqwlrxgetahvp.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh3empsZGRncXdscnhnZXRhaHZwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk3MzY1NTQsImV4cCI6MjA4NTMxMjU1NH0.MsCgDKBz3jXrJ_dOcJ35koaLi-uBpNXoAoaFLAWDbkg"
);

/* ===== VARIABLES ===== */
let currentClasse="", currentMatiere="";

const subjectsByClass={
  "6e":["Maths","FranÃ§ais","Anglais","Histoire","GÃ©ographie","SVT"],
  "5e":["Maths","FranÃ§ais","Anglais","Histoire","GÃ©ographie","SVT"],
  "4e":["Maths","FranÃ§ais","Anglais","Histoire","GÃ©ographie","SVT","Physique-Chimie"],
  "3e":["Maths","FranÃ§ais","Anglais","Histoire","GÃ©ographie","SVT","Physique-Chimie"]
};

/* ===== NAV ===== */
function show(id){
  document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

/* ===== CLASSES CLICK ===== */
document.querySelectorAll("[data-classe]").forEach(c=>{
  c.addEventListener("click",()=>{
    currentClasse=c.dataset.classe;
    document.getElementById("classeTitre").innerText="Classe "+currentClasse;
    let list=document.getElementById("subjectsList");
    list.innerHTML="";
    subjectsByClass[currentClasse].forEach(m=>{
      let d=document.createElement("div");
      d.className="card math";
      d.innerText=m;
      d.onclick=()=>openExercises(m);
      list.appendChild(d);
    });
    show("subjects");
  });
});

function openExercises(m){
  currentMatiere=m;
  document.getElementById("exerciseTitle").innerText=
    currentClasse+" â€“ "+m;
  loadExercises();
  show("exercisesSection");
}

/* ===== LOAD EXERCISES ===== */
const {data} = await supabaseClient
  .from("contents")
  .select("*");

  data.forEach(e=>{
    let d=document.createElement("div");
    d.className="item";
    d.innerHTML=`<b>${e.title}</b><br>
      ${e.file_url ? `<img src="${e.file_url}">` : ""}`;
    list.appendChild(d);
  });
}

/* ===== ADMIN ===== */
const adminModal=document.getElementById("adminModal");
document.getElementById("adminIcon").onclick=()=>adminModal.style.display="flex";
function closeAdmin(){adminModal.style.display="none"}

document.getElementById("loginBtn").onclick=()=>{
  if(document.getElementById("adminPass").value==="1234"){
    document.getElementById("adminPanel").style.display="block";
  }
};

document.getElementById("addBtn").onclick=async()=>{
  const file=document.getElementById("aFile").files[0];
  let url="";
  if(file){
    const path=Date.now()+"_"+file.name;
    await supabaseClient.storage.from("davidschool").upload(path,file);
    url=supabaseClient.storage.from("davidschool").getPublicUrl(path).data.publicUrl;
  }

  document.querySelectorAll("input[type=checkbox]:checked").forEach(cb=>{
    supabaseClient.from("contents").insert({
      classe:document.getElementById("aClasse").value,
      matiere:cb.value,
      title:document.getElementById("aTitle").value,
      file_url:url
    });
  });

  alert("Exercice ajoutÃ©");
  if(currentClasse && currentMatiere) loadExercises();
};

/* BACK */
document.getElementById("backToClasses").onclick=()=>show("classes");
document.getElementById("backToSubjects").onclick=()=>show("subjects");
</script>

</body>
</html>
