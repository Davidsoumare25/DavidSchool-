<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DavidSchool</title>
<style>
:root{
  --bg:#f4f7fb;
  --header:#1e3a8a;
  --admin:#f59e0b;
}
body{margin:0;font-family:Arial,sans-serif;background:var(--bg);}
header{background:var(--header);color:white;padding:15px;text-align:center;position:relative;font-size:22px;}
header button{position:absolute;right:15px;top:10px;padding:8px 12px;border:none;border-radius:8px;cursor:pointer;background:var(--admin);color:white;font-weight:bold;transition:0.2s;}
header button:hover{opacity:0.8;}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:12px;padding:20px;}
.card{padding:20px;border-radius:12px;color:white;text-align:center;font-weight:bold;cursor:pointer;transition:0.2s;}
.card:hover{transform:scale(1.05);}
.c6e{background:#16a34a}.c5e{background:#2563eb}.c4e{background:#9333ea}.c3e{background:#f59e0b}

/* Admin */
#adminModal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);align-items:center;justify-content:center;pointer-events:none;}
#adminModal.active{display:flex;pointer-events:auto}
.adminBox{background:white;padding:20px;width:90%;max-width:400px;border-radius:12px;}
.adminBox input, .adminBox select, .adminBox button{width:100%;margin:5px 0;padding:8px;}
</style>
</head>
<body>
<header>
üìò DavidSchool
<button onclick="openAdmin()">Admin</button>
</header>

<div id="classes">
  <h3 style="padding:0 20px">Choisis ta classe</h3>
  <div class="grid">
    <div class="card c6e" onclick="goContent('6e')">6e</div>
    <div class="card c5e" onclick="goContent('5e')">5e</div>
    <div class="card c4e" onclick="goContent('4e')">4e</div>
    <div class="card c3e" onclick="goContent('3e')">3e</div>
  </div>
</div>

<!-- Admin -->
<div id="adminModal">
  <div class="adminBox">
    <h3>Admin</h3>
    <input type="password" id="adminPass" placeholder="Mot de passe">
    <button onclick="login()">Entrer</button>

    <div id="adminPanel" style="display:none">
      <select id="aClass">
        <option>6e</option><option>5e</option><option>4e</option><option>3e</option>
      </select>
      <p>Mati√®res (optionnelles)</p>
      <label><input type="checkbox" value="Math"> Math</label><br>
      <label><input type="checkbox" value="Fran√ßais"> Fran√ßais</label><br>
      <label><input type="checkbox" value="Anglais"> Anglais</label><br>
      <label><input type="checkbox" value="Histoire"> Histoire</label><br>
      <label><input type="checkbox" value="G√©ographie"> G√©ographie</label><br>
      <label><input type="checkbox" value="SVT"> SVT</label><br>
      <label><input type="checkbox" value="Physique-Chimie"> Physique-Chimie</label><br>
      <select id="aType">
        <option value="exercise">Exercice</option>
        <option value="lesson">Le√ßon</option>
      </select>
      <input id="aTitle" placeholder="Titre">
      <input type="file" id="aFile">
      <button onclick="addContent()">Ajouter</button>
    </div>
    <button onclick="closeAdmin()">Fermer</button>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const SUPABASE_URL = "https://xwzjlddgqwlrxgetahvp.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh3empsZGRncX...";
const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

function goContent(classe){
  window.location.href = "contenu.html?classe="+classe;
}

/* Admin */
function openAdmin(){document.getElementById("adminModal").classList.add("active")}
function closeAdmin(){document.getElementById("adminModal").classList.remove("active")}
function login(){
  const pass = document.getElementById("adminPass").value;
  if(pass==="1234") document.getElementById("adminPanel").style.display="block";
}
async function addContent(){
  const file = document.getElementById("aFile").files[0];
  if(!file){alert("S√©lectionne un fichier"); return;}
  const path = Date.now()+"_"+file.name;
  await supabase.storage.from("davidschool").upload(path,file);
  const {data:{publicUrl}} = supabase.storage.from("davidschool").getPublicUrl(path);

  const type = document.getElementById("aType").value;
  const title = document.getElementById("aTitle").value;
  const classe = document.getElementById("aClass").value;
  document.querySelectorAll('input[type=checkbox]:checked').forEach(cb=>{
    supabase.from("contents").insert({
      classe:classe,
      matiere:cb.value,
      type:type,
      title:title,
      file_url:publicUrl
    });
  });
  alert("Ajout√© !");
}
</script>
</body>
</html>
