<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DavidSchool</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{margin:0;font-family:Arial;background:#f4f7fb}
header{background:#1e90ff;color:#fff;padding:15px;text-align:center;font-size:22px}
#adminIcon{position:fixed;top:10px;left:10px;background:#fff;color:#1e90ff;
padding:8px 10px;border-radius:50%;cursor:pointer;z-index:999}
.container{padding:20px}

.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:15px}
.card{padding:15px;border-radius:12px;color:#fff;font-weight:bold;
text-align:center;cursor:pointer;box-shadow:0 4px 8px rgba(0,0,0,.1)}
.card:hover{transform:scale(1.05)}

#subjects,#content{display:none}
.columns{display:flex;gap:15px;flex-wrap:wrap}
.column{flex:1;background:#fff;border-radius:10px;padding:10px}

.item{
background:#eef4ff;
margin-bottom:10px;
padding:10px;
border-radius:8px;
cursor:pointer;
font-weight:bold
}
.item:hover{background:#dbe9ff}

.backBtn{
background:#1e90ff;color:#fff;border:none;
padding:6px 12px;border-radius:6px;
margin-bottom:10px;cursor:pointer
}

#popup{
display:none;position:fixed;inset:0;
background:rgba(0,0,0,.7);
justify-content:center;align-items:center;z-index:2000
}
#popupBox{
background:#fff;width:90%;max-height:90%;
padding:10px;border-radius:10px;overflow:auto
}

/* ADMIN */
#adminModal{
display:none;position:fixed;inset:0;
background:rgba(0,0,0,.7);z-index:3000
}
#adminBox{
background:#fff;width:90%;max-width:400px;
margin:60px auto;padding:15px;border-radius:10px
}
input,select,button{
width:100%;margin:6px 0;padding:8px
}
</style>
</head>

<body>

<header>üìò DavidSchool</header>
<div id="adminIcon">‚öô</div>

<div class="container">
<button id="backBtn" class="backBtn" onclick="goBack()">‚Üê Retour</button>

<div id="classes" class="grid"></div>
<div id="subjects" class="grid"></div>

<div id="content" class="columns">
  <div class="column">
    <h3>üìÑ Exercices</h3>
    <div id="exercises"></div>
  </div>
  <div class="column">
    <h3>üìñ Le√ßons</h3>
    <div id="lessons"></div>
  </div>
</div>
</div>

<div id="popup" onclick="this.style.display='none'">
  <div id="popupBox"></div>
</div>

<div id="adminModal">
  <div id="adminBox">
    <h3>Admin</h3>
    <input type="password" id="adminPass" placeholder="Mot de passe">
    <button onclick="login()">Entrer</button>

    <div id="adminPanel" style="display:none">
      <select id="aClass"></select>
      <select id="aSubject">
        <option value="">Toutes les mati√®res</option>
      </select>
      <select id="aType">
        <option value="exercise">Exercice</option>
        <option value="lesson">Le√ßon</option>
      </select>
      <input id="aTitle" placeholder="Titre">
      <input type="file" id="aFile">
      <button onclick="addContent()">Ajouter</button>
    </div>

    <button onclick="adminModal.style.display='none'">Fermer</button>
  </div>
</div>

<script>
const db = supabase.createClient(
"https://xwzjlddgqwlrxgetahvp.supabase.co",
"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh3empsZGRncXdscnhnZXRhaHZwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk3MzY1NTQsImV4cCI6MjA4NTMxMjU1NH0.MsCgDKBz3jXrJ_dOcJ35koaLi-uBpNXoAoaFLAWDbkg"
);

const classesData={
"6e":["Math","Fran√ßais","Anglais","Histoire","G√©ographie","SVT"],
"5e":["Math","Fran√ßais","Anglais","Histoire","G√©ographie","SVT"],
"4e":["Math","Fran√ßais","Anglais","Histoire","G√©ographie","SVT","Physique-Chimie"],
"3e":["Math","Fran√ßais","Anglais","Histoire","G√©ographie","SVT","Physique-Chimie"]
};

const colors=["#f44336","#9c27b0","#2196f3","#ff9800","#009688","#795548"];

let currentClass="",currentSubject="";

const classes=document.getElementById("classes");
const subjects=document.getElementById("subjects");
const content=document.getElementById("content");
const exercises=document.getElementById("exercises");
const lessons=document.getElementById("lessons");
const backBtn=document.getElementById("backBtn");

function init(){
let i=0;
for(const c in classesData){
let d=document.createElement("div");
d.className="card";
d.style.background=colors[i++%colors.length];
d.textContent=c;
d.onclick=()=>selectClass(c);
classes.appendChild(d);

let o=document.createElement("option");
o.value=c;o.textContent=c;
aClass.appendChild(o);
}

[...new Set(Object.values(classesData).flat())].forEach(m=>{
let o=document.createElement("option");
o.value=m;o.textContent=m;
aSubject.appendChild(o);
});
}
init();

function selectClass(c){
currentClass=c;
classes.style.display="none";
subjects.innerHTML="";
let i=0;
classesData[c].forEach(m=>{
let d=document.createElement("div");
d.className="card";
d.style.background=colors[i++%colors.length];
d.textContent=m;
d.onclick=()=>selectSubject(m);
subjects.appendChild(d);
});
subjects.style.display="grid";
backBtn.style.display="inline-block";
}

function selectSubject(m){
currentSubject=m;
subjects.style.display="none";
content.style.display="flex";
loadContent();
}

function goBack(){
if(content.style.display==="flex"){
content.style.display="none";
subjects.style.display="grid";
}else{
subjects.style.display="none";
classes.style.display="grid";
backBtn.style.display="none";
}
}

async function loadContent(){
exercises.innerHTML="";
lessons.innerHTML="";
const {data}=await db
.from("contents")
.select("*")
.eq("classe",currentClass)
.or(`matiere.eq.${currentSubject},matiere.eq.`);

data.forEach(d=>{
let div=document.createElement("div");
div.className="item";
div.textContent=d.title;
div.onclick=()=>{
popupBox.innerHTML=d.file_url.endsWith(".pdf")
?`<iframe src="${d.file_url}" style="width:100%;height:80vh"></iframe>`
:`<img src="${d.file_url}" style="width:100%">`;
popup.style.display="flex";
};
(d.type==="exercise"?exercises:lessons).appendChild(div);
});
}

adminIcon.onclick=()=>adminModal.style.display="block";
function login(){
if(adminPass.value==="1234") adminPanel.style.display="block";
else alert("Mot de passe incorrect");
}

async function addContent(){
const f=aFile.files[0]; if(!f)return;
const p=Date.now()+"_"+f.name;
await db.storage.from("davidschool").upload(p,f);
const {data:{publicUrl}}=db.storage.from("davidschool").getPublicUrl(p);
await db.from("contents").insert({
classe:aClass.value,
matiere:aSubject.value,
type:aType.value,
title:aTitle.value,
file_url:publicUrl
});
alert("Ajout√© !");
}
</script>
</body>
</html>
