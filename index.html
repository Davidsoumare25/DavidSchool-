<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DavidSchool</title>
<style>
:root{
  --bg:#f4f7fb;
  --header:#1e3a8a;
  --admin:#f59e0b;
}
body{margin:0;font-family:Arial,sans-serif;background:var(--bg);}
header{background:var(--header);color:white;padding:15px;text-align:center;position:relative;font-size:22px;}
header button{position:absolute;right:15px;top:10px;padding:8px 12px;border:none;border-radius:8px;cursor:pointer;background:var(--admin);color:white;font-weight:bold;transition:0.2s;}
header button:hover{opacity:0.8;}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:12px;padding:20px;}
.card{padding:20px;border-radius:12px;color:white;text-align:center;font-weight:bold;cursor:pointer;transition:0.2s;}
.card:hover{transform:scale(1.05);}
.c6e{background:#16a34a}.c5e{background:#2563eb}.c4e{background:#9333ea}.c3e{background:#f59e0b}
/* Admin */
#adminModal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);align-items:center;justify-content:center;pointer-events:none;}
#adminModal.active{display:flex;pointer-events:auto}
.adminBox{background:white;padding:20px;width:90%;max-width:400px;border-radius:12px;}
.adminBox input, .adminBox select, .adminBox button{width:100%;margin:5px 0;padding:8px;}
</style>
</head>
<body>
<header>
üìò DavidSchool
<button id="openAdminBtn">Admin</button>
</header>

<div id="classes">
  <h3 style="padding:0 20px">Choisis ta classe</h3>
  <div class="grid" id="classGrid"></div>
</div>

<!-- Admin -->
<div id="adminModal">
  <div class="adminBox">
    <h3>Admin</h3>
    <input type="password" id="adminPass" placeholder="Mot de passe">
    <button id="loginBtn">Entrer</button>

    <div id="adminPanel" style="display:none">
      <select id="aClass">
        <option>6e</option><option>5e</option><option>4e</option><option>3e</option>
      </select>
      <p>Mati√®res (optionnelles)</p>
      <div id="subjectCheckboxes"></div>
      <select id="aType">
        <option value="exercise">Exercice</option>
        <option value="lesson">Le√ßon</option>
      </select>
      <input id="aTitle" placeholder="Titre">
      <input type="file" id="aFile">
      <button id="addContentBtn">Ajouter</button>
    </div>
    <button id="closeAdminBtn">Fermer</button>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const SUPABASE_URL = "https://xwzjlddgqwlrxgetahvp.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh3empsZGRncX...";
const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

const classes = ["6e","5e","4e","3e"];
const subjectsByClass = {
  "6e":["Math","Fran√ßais","Anglais","Histoire","G√©ographie","SVT"],
  "5e":["Math","Fran√ßais","Anglais","Histoire","G√©ographie","SVT"],
  "4e":["Math","Fran√ßais","Anglais","Histoire","G√©ographie","SVT","Physique-Chimie"],
  "3e":["Math","Fran√ßais","Anglais","Histoire","G√©ographie","SVT","Physique-Chimie"]
};

// G√©n√©rer les classes
const classGrid = document.getElementById("classGrid");
classes.forEach(classe=>{
  const div = document.createElement("div");
  div.className="card c"+classe[0]+"e";
  div.innerText = classe;
  div.addEventListener("click",()=>selectClass(classe));
  classGrid.appendChild(div);
});

// G√©n√©rer les checkboxes des mati√®res
const subjectCheckboxes = document.getElementById("subjectCheckboxes");
const allSubjects = ["Math","Fran√ßais","Anglais","Histoire","G√©ographie","SVT","Physique-Chimie"];
allSubjects.forEach(s=>{
  const label = document.createElement("label");
  label.innerHTML = `<input type="checkbox" value="${s}"> ${s}`;
  subjectCheckboxes.appendChild(label);
  subjectCheckboxes.appendChild(document.createElement("br"));
});

// Admin
const adminModal = document.getElementById("adminModal");
const adminPanel = document.getElementById("adminPanel");
document.getElementById("openAdminBtn").addEventListener("click",()=>adminModal.classList.add("active"));
document.getElementById("closeAdminBtn").addEventListener("click",()=>adminModal.classList.remove("active"));
document.getElementById("loginBtn").addEventListener("click",()=>{
  if(document.getElementById("adminPass").value==="1234") adminPanel.style.display="block";
});

// Ajouter contenu
document.getElementById("addContentBtn").addEventListener("click", async ()=>{
  const file = document.getElementById("aFile").files[0];
  if(!file){alert("S√©lectionne un fichier"); return;}
  const path = Date.now()+"_"+file.name;
  await supabase.storage.from("davidschool").upload(path,file);
  const {data:{publicUrl}} = supabase.storage.from("davidschool").getPublicUrl(path);
  const type = document.getElementById("aType").value;
  const title = document.getElementById("aTitle").value;
  const classe = document.getElementById("aClass").value;
  document.querySelectorAll('#subjectCheckboxes input[type=checkbox]:checked').forEach(cb=>{
    supabase.from("contents").insert({
      classe:classe,
      matiere:cb.value,
      type:type,
      title:title,
      file_url:publicUrl
    });
  });
  alert("Ajout√© !");
});

// Navigation vers contenu
function selectClass(classe){
  const subjects = subjectsByClass[classe];
  let matiere = subjects[0]; // par d√©faut la premi√®re mati√®re
  window.location.href = `contenu.html?classe=${classe}&matiere=${matiere}`;
}
</script>
</body>
</html>
