<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DavidSchool</title>
<style>
:root{
  --bg:#f4f7fb;
  --header:#1e3a8a;
  --admin:#f59e0b;
}
body{
  margin:0;
  font-family:Arial,sans-serif;
  background:var(--bg);
}
header{
  background:var(--header);
  color:white;
  padding:15px;
  text-align:center;
  font-size:22px;
  position:relative;
  box-shadow:0 3px 6px rgba(0,0,0,.1);
}
header button{
  position:absolute;
  right:15px;
  top:10px;
  padding:8px 12px;
  border:none;
  border-radius:8px;
  cursor:pointer;
  background:var(--admin);
  color:white;
  font-weight:bold;
  transition:.2s;
}
header button:hover{opacity:.85;}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(120px,1fr));
  gap:12px;
  padding:20px;
}
.card{
  padding:25px;
  border-radius:12px;
  color:white;
  text-align:center;
  font-weight:bold;
  font-size:18px;
  cursor:pointer;
  transition:0.2s;
  box-shadow:0 2px 6px rgba(0,0,0,.1);
}
.card:hover{transform:scale(1.05);}

.c6e{background:#16a34a}
.c5e{background:#2563eb}
.c4e{background:#9333ea}
.c3e{background:#f59e0b}

/* Colonnes contenu */
.columns{
  display:flex;
  gap:20px;
  padding:20px;
  flex-wrap:wrap;
}
.column{
  flex:1;
  background:white;
  padding:15px;
  border-radius:12px;
  min-width:280px;
  box-shadow:0 2px 8px rgba(0,0,0,.1);
}
.column h3{text-align:center; margin-top:0;}
.item{
  border-bottom:1px solid #eee;
  padding:10px 0;
}
.item img{max-width:100%;border-radius:8px;}
.item a{color:#1e3a8a;text-decoration:none;font-weight:bold;}
.item a:hover{text-decoration:underline;}

/* Admin */
#adminModal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  align-items:center;
  justify-content:center;
  pointer-events:none;
}
#adminModal.active{
  display:flex;
  pointer-events:auto;
}
.adminBox{
  background:white;
  padding:20px;
  width:90%;
  max-width:450px;
  border-radius:12px;
}
.adminBox input, .adminBox select, .adminBox button{
  width:100%;
  margin:6px 0;
  padding:8px;
  border-radius:6px;
}
.adminBox button{
  cursor:pointer;
  background:#1e3a8a;
  color:white;
  border:none;
  font-weight:bold;
}
</style>
</head>
<body>

<header>
  üìò DavidSchool
  <button id="openAdminBtn">Admin</button>
</header>

<div id="classesSection">
  <h3 style="padding-left:20px">Choisis ta classe</h3>
  <div class="grid" id="classGrid"></div>
</div>

<div id="subjectsSection" style="display:none">
  <h3 style="padding-left:20px">Mati√®res</h3>
  <div class="grid" id="subjectGrid"></div>
</div>

<div class="columns" id="contentColumns" style="display:none">
  <div class="column">
    <h3>‚úèÔ∏è Exercices</h3>
    <div id="exercisesColumn"></div>
  </div>
  <div class="column">
    <h3>üìò Le√ßons</h3>
    <div id="lessonsColumn"></div>
  </div>
</div>

<!-- Admin -->
<div id="adminModal">
  <div class="adminBox">
    <h3>Admin</h3>
    <input type="password" id="adminPass" placeholder="Mot de passe">
    <button id="loginBtn">Entrer</button>

    <div id="adminPanel" style="display:none">
      <select id="aClass">
        <option>6e</option><option>5e</option><option>4e</option><option>3e</option>
      </select>
      <p>Mati√®res (optionnelles)</p>
      <div id="subjectCheckboxes"></div>
      <select id="aType">
        <option value="exercise">Exercice</option>
        <option value="lesson">Le√ßon</option>
      </select>
      <input id="aTitle" placeholder="Titre">
      <input type="file" id="aFile">
      <button id="addContentBtn">Ajouter</button>
    </div>
    <button id="closeAdminBtn">Fermer</button>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
// üî¥ Supabase
const SUPABASE_URL = "https://xwzjlddgqwlrxgetahvp.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...";
const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

// Classes et mati√®res
const classes = ["6e","5e","4e","3e"];
const subjectsByClass = {
  "6e":["Math","Fran√ßais","Anglais","Histoire","G√©ographie","SVT"],
  "5e":["Math","Fran√ßais","Anglais","Histoire","G√©ographie","SVT"],
  "4e":["Math","Fran√ßais","Anglais","Histoire","G√©ographie","SVT","Physique-Chimie"],
  "3e":["Math","Fran√ßais","Anglais","Histoire","G√©ographie","SVT","Physique-Chimie"]
};

// Affichage classes
const classGrid = document.getElementById("classGrid");
classes.forEach(cl=>{
  const div = document.createElement("div");
  div.className = "card c"+cl[0]+"e";
  div.innerText = cl;
  div.addEventListener("click", ()=>selectClass(cl));
  classGrid.appendChild(div);
});

// Affichage mati√®res
const subjectGrid = document.getElementById("subjectGrid");
function selectClass(cl){
  currentClass = cl;
  classesSection.style.display="none";
  subjectGrid.innerHTML="";
  subjectsByClass[cl].forEach(sub=>{
    const div = document.createElement("div");
    div.className="card";
    div.style.background="#2563eb"; // couleur par d√©faut pour mati√®re
    div.innerText=sub;
    div.addEventListener("click", ()=>selectSubject(sub));
    subjectGrid.appendChild(div);
  });
  subjectsSection.style.display="grid";
}

function selectSubject(sub){
  currentSubject=sub;
  subjectsSection.style.display="none";
  contentColumns.style.display="flex";
  loadContent();
}

// Colonnes
const exercisesColumn = document.getElementById("exercisesColumn");
const lessonsColumn = document.getElementById("lessonsColumn");

async function loadContent(){
  exercisesColumn.innerHTML="";
  lessonsColumn.innerHTML="";
  const {data,error} = await supabase.from("contents").select("*")
    .eq("classe",currentClass).eq("matiere",currentSubject);
  if(error){console.error(error); return;}
  data.forEach(d=>{
    const div=document.createElement("div");
    div.className="item";
    if(d.file_url.endsWith(".pdf")){
      div.innerHTML=`<b>${d.title}</b><br><a href="${d.file_url}" target="_blank">T√©l√©charger</a>`;
    } else {
      div.innerHTML=`<b>${d.title}</b><br><img src="${d.file_url}">`;
    }
    if(d.type==="exercise") exercisesColumn.appendChild(div);
    else lessonsColumn.appendChild(div);
  });
}

// Admin
const adminModal = document.getElementById("adminModal");
const adminPanel = document.getElementById("adminPanel");
document.getElementById("openAdminBtn").addEventListener("click",()=>adminModal.classList.add("active"));
document.getElementById("closeAdminBtn").addEventListener("click",()=>adminModal.classList.remove("active"));
document.getElementById("loginBtn").addEventListener("click",()=>{
  if(document.getElementById("adminPass").value==="1234") adminPanel.style.display="block";
});

// Checkboxes mati√®res
const subjectCheckboxes = document.getElementById("subjectCheckboxes");
const allSubjects = ["Math","Fran√ßais","Anglais","Histoire","G√©ographie","SVT","Physique-Chimie"];
allSubjects.forEach(s=>{
  const label=document.createElement("label");
  label.innerHTML=`<input type="checkbox" value="${s}"> ${s}`;
  subjectCheckboxes.appendChild(label);
  subjectCheckboxes.appendChild(document.createElement("br"));
});

// Ajouter contenu et l'afficher imm√©diatement
document.getElementById("addContentBtn").addEventListener("click", async ()=>{
  const file = document.getElementById("aFile").files[0];
  if(!file){alert("S√©lectionne un fichier"); return;}
  const path = Date.now()+"_"+file.name;
  await supabase.storage.from("davidschool").upload(path,file);
  const {data:{publicUrl}} = supabase.storage.from("davidschool").getPublicUrl(path);
  const type = document.getElementById("aType").value;
  const title = document.getElementById("aTitle").value;
  const classe = document.getElementById("aClass").value;

  document.querySelectorAll('#subjectCheckboxes input[type=checkbox]:checked').forEach(cb=>{
    supabase.from("contents").insert({
      classe:classe,
      matiere:cb.value,
      type:type,
      title:title,
      file_url:publicUrl
    });
    const div=document.createElement("div");
    div.className="item";
    if(file.name.endsWith(".pdf")){
      div.innerHTML=`<b>${title}</b><br><a href="${publicUrl}" target="_blank">T√©l√©charger</a>`;
    } else {
      div.innerHTML=`<b>${title}</b><br><img src="${publicUrl}">`;
    }
    if(type==="exercise") exercisesColumn.appendChild(div);
    else lessonsColumn.appendChild(div);
  });

  alert("Ajout√© !");
});
</script>

</body>
  </html>
