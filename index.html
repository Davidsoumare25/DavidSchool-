<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DavidSchool</title>

<!-- Supabase -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
:root{
  --main:#1e90ff;
  --bg:#f4f7fb;
  --card:#ffffff;
}
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:var(--bg);
}
header{
  background:var(--main);
  color:white;
  padding:15px;
  text-align:center;
  font-size:22px;
}
#adminIcon{
  position:fixed;
  top:10px;
  left:10px;
  background:white;
  color:var(--main);
  padding:8px 10px;
  border-radius:50%;
  cursor:pointer;
  font-weight:bold;
  z-index:2000;
}
.container{
  padding:20px;
}
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(120px,1fr));
  gap:15px;
}
.card{
  background:var(--card);
  padding:15px;
  border-radius:10px;
  text-align:center;
  cursor:pointer;
  box-shadow:0 2px 6px rgba(0,0,0,.1);
}
.card:hover{
  transform:scale(1.05);
}
#subjects,#content{display:none;}

.columns{
  display:flex;
  gap:15px;
  flex-wrap:wrap;
}
.column{
  flex:1;
  background:white;
  padding:10px;
  border-radius:10px;
  min-width:200px;
}
.item{
  border-bottom:1px solid #eee;
  padding:8px;
}
.item img{
  max-width:100%;
  border-radius:8px;
}

/* ADMIN */
#adminModal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  z-index:3000;
}
#adminBox{
  background:white;
  width:90%;
  max-width:400px;
  margin:60px auto;
  padding:15px;
  border-radius:10px;
}
input,select,button{
  width:100%;
  margin:6px 0;
  padding:8px;
  box-sizing:border-box;
}
</style>
</head>

<body>

<header>ðŸ“˜ DavidSchool</header>
<div id="adminIcon">âš™</div>

<div class="container">

<!-- CLASSES -->
<div id="classes" class="grid">
  <div class="card" onclick="selectClass('6e')">6e</div>
  <div class="card" onclick="selectClass('5e')">5e</div>
  <div class="card" onclick="selectClass('4e')">4e</div>
  <div class="card" onclick="selectClass('3e')">3e</div>
</div>

<!-- MATIÃˆRES -->
<div id="subjects" class="grid"></div>

<!-- CONTENU -->
<div id="content" class="columns">
  <div class="column">
    <h3>ðŸ“„ Exercices</h3>
    <div id="exercises"></div>
  </div>
  <div class="column">
    <h3>ðŸ“– LeÃ§ons</h3>
    <div id="lessons"></div>
  </div>
</div>

</div>

<!-- ADMIN -->
<div id="adminModal">
  <div id="adminBox">
    <h3>Admin</h3>
    <input type="password" id="adminPass" placeholder="Mot de passe">
    <button onclick="login()">Entrer</button>

    <div id="adminPanel" style="display:none">
      <select id="aClass">
        <option>6e</option><option>5e</option><option>4e</option><option>3e</option>
      </select>
      <input id="aSubject" placeholder="MatiÃ¨re">
      <select id="aType">
        <option value="exercise">Exercice</option>
        <option value="lesson">LeÃ§on</option>
      </select>
      <input id="aTitle" placeholder="Titre">
      <input type="file" id="aFile">
      <button onclick="addContent()">Ajouter</button>
    </div>

    <button onclick="closeAdmin()">Fermer</button>
  </div>
</div>

<script>
// ðŸ”´ SUPABASE CONFIG
const SUPABASE_URL = "https://xwzjlddgqwlrxgetahvp.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh3empsZGRncXdscnhnZXRhaHZwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk3MzY1NTQsImV4cCI6MjA4NTMxMjU1NH0.MsCgDKBz3jXrJ_dOcJ35koaLi-uBpNXoAoaFLAWDbkg";

const db = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

// VARIABLES DOM
const adminIcon = document.getElementById("adminIcon");
const adminModal = document.getElementById("adminModal");
const adminPanel = document.getElementById("adminPanel");
const adminPass = document.getElementById("adminPass");

const classesBox = document.getElementById("classes");
const subjectsBox = document.getElementById("subjects");
const contentBox = document.getElementById("content");

const exercises = document.getElementById("exercises");
const lessons = document.getElementById("lessons");

// LOGIQUE
let currentClass="", currentSubject="";
const subjectsByClass={
  "6e":["Math","FranÃ§ais","Anglais","Histoire","GÃ©ographie","SVT"],
  "5e":["Math","FranÃ§ais","Anglais","Histoire","GÃ©ographie","SVT"],
  "4e":["Math","FranÃ§ais","Anglais","Histoire","GÃ©ographie","SVT","Physique-Chimie"],
  "3e":["Math","FranÃ§ais","Anglais","Histoire","GÃ©ographie","SVT","Physique-Chimie"]
};

function selectClass(c){
  currentClass=c;
  classesBox.style.display="none";
  subjectsBox.innerHTML="";
  subjectsByClass[c].forEach(m=>{
    const div=document.createElement("div");
    div.className="card";
    div.textContent=m;
    div.onclick=()=>selectSubject(m);
    subjectsBox.appendChild(div);
  });
  subjectsBox.style.display="grid";
}

function selectSubject(m){
  currentSubject=m;
  subjectsBox.style.display="none";
  contentBox.style.display="flex";
  loadContent();
}

async function loadContent(){
  exercises.innerHTML="";
  lessons.innerHTML="";
  const {data,error}=await db
    .from("contents")
    .select("*")
    .eq("classe",currentClass)
    .eq("matiere",currentSubject);
  if(error){console.log(error);return;}
  data.forEach(d=>{
    const div=document.createElement("div");
    div.className="item";
    div.innerHTML=`<b>${d.title}</b><br>${
      d.file_url.endsWith(".pdf")
      ? `<a href="${d.file_url}" target="_blank">TÃ©lÃ©charger</a>`
      : `<img src="${d.file_url}">`
    }`;
    (d.type==="exercise"?exercises:lessons).appendChild(div);
  });
}

// ADMIN
adminIcon.addEventListener("click",()=>adminModal.style.display="block");
function closeAdmin(){adminModal.style.display="none";}
function login(){
  if(adminPass.value==="1234"){
    adminPanel.style.display="block";
  }else{
    alert("Mot de passe incorrect !");
  }
}

async function addContent(){
  const file=aFile.files[0];
  if(!file){alert("SÃ©lectionne un fichier !"); return;}
  const path=Date.now()+"_"+file.name;
  await db.storage.from("davidschool").upload(path,file);
  const {data:{publicUrl}}=db.storage.from("davidschool").getPublicUrl(path);
  await db.from("contents").insert({
    classe:aClass.value,
    matiere:aSubject.value,
    type:aType.value,
    title:aTitle.value,
    file_url:publicUrl
  });
  alert("AjoutÃ© !");
  aTitle.value="";
  aFile.value="";
}
</script>
</body>
</html>
